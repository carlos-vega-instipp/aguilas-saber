<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Préstamos</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
</head>
<style>
    .pagination .page-item .page-link {
        background-color: white;
        color: #007bff; 
        border: 1px solid #dee2e6; 
    }

    .pagination .page-item.active .page-link {
        background-color: white; 
        color: #007bff; 
        border: 1px solid #ddd5d5; 
    }

    .pagination .page-item .page-link:hover {
        background-color: #f8f9fa; 
    }
</style>
<body>
    <div class="d-flex">
        <!-- Sidebar -->
        <div class="bg-dark text-white p-3" id="sidebar" style="width: 250px; height: 100vh;">
            <div class="text-center mb-4">
                <img src="../../static/img/fondo_aguilas_saber.png" alt="Logo Maky System" class="img-fluid mb-2" style="max-height: 80px;">
                <h4>Maky System</h4>
            </div>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a href="../../paginas/pagina_inicio/home.html" class="nav-link text-white d-flex align-items-center">
                        <i class="fas fa-home me-2"></i>Inicio
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#adminSubmenu" class="nav-link text-white d-flex align-items-center" data-bs-toggle="collapse" aria-expanded="false" aria-controls="adminSubmenu">
                        <i class="fas fa-cogs me-2"></i>Administración <i class="fas fa-chevron-down ms-auto"></i>
                    </a>
                    <div class="collapse" id="adminSubmenu">
                        <ul class="nav flex-column ms-3">
                            <li class="nav-item">
                                <a href="../../paginas/usuarios/listado-usuarios.html" class="nav-link text-white d-flex align-items-center">
                                    <i class="fas fa-users me-2"></i>Usuarios
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/recursos/recursos.html" class="nav-link text-white d-flex align-items-center">
                                    <i class="fas fa-boxes me-2"></i>Recursos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/prestamos/prestamos.html" class="nav-link text-white d-flex align-items-center">
                                    <i class="fas fa-archive me-2"></i>Préstamos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/devoluciones/devoluciones.html" class="nav-link text-white d-flex align-items-center">
                                    <i class="fas fa-undo me-2"></i>Devoluciones
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/productos/listado-productos.html" class="nav-link text-white d-flex align-items-center">
                                    <i class="fas fa-shopping-cart me-2"></i>Productos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/roles/listado-roles.html" class="nav-link text-white d-flex align-items-center">
                                    <i class="fas fa-user-shield me-2"></i>Gestionar Rol
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/roles/gestion-permisos.html" class="nav-link text-white d-flex align-items-center">
                                    <i class="fas fa-key me-2"></i>Gestionar Permisos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/recursos/estado-recursos.html" class="nav-link text-white d-flex align-items-center">
                                    <i class="fas fa-chart-line me-2"></i>Ver Estado de Recursos
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
            <hr class="text-secondary">
            <a href="../../paginas/index/index.html" class="btn btn-danger w-100">Cerrar sesión</a>
        </div>

        <!-- Main Content -->
        <div class="flex-grow-1 p-4 bg-light">
            <h1 class="h4 mb-2">Gestión de Préstamos</h1>
            <hr style="margin: 0.5rem 0; border: 1px solid rgba(0, 0, 0, 0.1); box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);">
            <p class="mt-1">Registrar y gestionar préstamos de artículos</p>
            <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#loanModal">Registrar Préstamo</button>

            <!-- Filtros y Búsqueda -->
            <div class="d-flex justify-content-between mb-3">
                <div class="d-flex align-items-center">
                    <label for="resourcePerPage" class="me-2">Mostrar:</label>
                    <select id="resourcePerPage" class="form-select w-auto" onchange="changeItemsPerPage()">
                        <option value="10">10 Préstamos</option>
                        <option value="20">20 Préstamos</option>
                    </select>
                </div>
                <div class="input-group w-50">
                    <input type="text" id="searchInput" class="form-control" placeholder="Buscar préstamos" oninput="searchLoans()">
                    <button class="btn btn-outline-secondary" id="searchButton" onclick="searchLoans()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>                
            </div>

            <!-- Tabla de Préstamos -->
            <table class="table table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Solicitante</th>
                        <th>Tipo</th>
                        <th>Artículo</th>
                        <th>Fecha de Préstamo</th>
                        <th>Fecha de Devolución</th>
                        <th>Estado</th>
                        <th>Acciones</th>
                    </tr>
                </thead>
                <tbody id="loanTableBody">
                    
                </tbody>                    
            </table>

            
            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center" id="pagination">
                    
                </ul>
            </nav>
        </div>
    </div>

    <!-- Modal para Registrar Préstamo -->
    <div class="modal fade" id="loanModal" tabindex="-1" aria-labelledby="loanModalLabel" aria-hidden="true">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="loanModalLabel">Registrar Préstamo</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                </div>
                <div class="modal-body">
                    <form id="loanForm">
                        <div class="mb-3">
                            <label for="borrowerName" class="form-label">Nombre del Solicitante</label>
                            <input type="text" class="form-control" id="borrowerName" required>
                        </div>
                        <div class="mb-3">
                            <label for="articleTitle" class="form-label">Título del Artículo</label>
                            <input type="text" class="form-control" id="articleTitle" required>
                        </div>
                        <div class="mb-3">
                            <label for="loanDate" class="form-label">Fecha de Préstamo</label>
                            <input type="date" class="form-control" id="loanDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="returnDate" class="form-label">Fecha de Devolución</label>
                            <input type="date" class="form-control" id="returnDate" required>
                        </div>
                        <div class="mb-3">
                            <label for="articleType" class="form-label">Tipo de Artículo</label>
                            <select class="form-select" id="articleType" required>
                                <option value="Computadora">Computadora</option>
                                <option value="Impresora">Impresora</option>
                                <option value="Accesorio">Accesorio</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    <button type="button" class="btn btn-primary" onclick="registerLoan()">Registrar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-danger text-white text-center py-3 mt-auto">
        © 2024 Maky System. Todos los derechos reservados.
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        
        let loans = [
    { id: 1, borrower: 'Juan Pérez', articleTitle: 'Computadora Lenovo', loanDate: '2024-12-01', returnDate: '2024-12-10', articleType: 'Computadora', status: 'No Devuelto' },
    { id: 2, borrower: 'María Gómez', articleTitle: 'Impresora HP', loanDate: '2024-12-05', returnDate: '2024-12-12', articleType: 'Impresora', status: 'Devuelto' },
    { id: 3, borrower: 'Carlos Ruiz', articleTitle: 'Accesorio de teclado', loanDate: '2024-12-07', returnDate: '2024-12-15', articleType: 'Accesorio', status: 'No Devuelto' },
    { id: 4, borrower: 'Lucía Fernández', articleTitle: 'Mouse Logitech', loanDate: '2024-12-03', returnDate: '2024-12-13', articleType: 'Accesorio', status: 'Devuelto' },
    { id: 5, borrower: 'Pedro Castillo', articleTitle: 'Monitor Samsung', loanDate: '2024-12-10', returnDate: '2024-12-17', articleType: 'Computadora', status: 'No Devuelto' },
    { id: 6, borrower: 'Ana Torres', articleTitle: 'Impresora Canon', loanDate: '2024-12-08', returnDate: '2024-12-14', articleType: 'Impresora', status: 'No Devuelto' },
    { id: 7, borrower: 'Sofía Morales', articleTitle: 'Laptop HP', loanDate: '2024-12-02', returnDate: '2024-12-09', articleType: 'Computadora', status: 'Devuelto' },
    { id: 8, borrower: 'Diego Vargas', articleTitle: 'Proyector Epson', loanDate: '2024-12-04', returnDate: '2024-12-11', articleType: 'Accesorio', status: 'No Devuelto' },
    { id: 9, borrower: 'Elena Rivas', articleTitle: 'Teclado Razer', loanDate: '2024-12-06', returnDate: '2024-12-15', articleType: 'Accesorio', status: 'Devuelto' },
    { id: 10, borrower: 'Andrés López', articleTitle: 'Impresora Brother', loanDate: '2024-12-09', returnDate: '2024-12-18', articleType: 'Impresora', status: 'No Devuelto' }
];

        let itemsPerPage = 10;
        let currentPage = 1;
        let filteredLoans = loans;

        function renderTable(page) {
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = startIndex + itemsPerPage;
            const loansToShow = filteredLoans.slice(startIndex, endIndex);

            const tableBody = document.getElementById('loanTableBody');
            tableBody.innerHTML = '';

            loansToShow.forEach((loan, index) => {
                const row = document.createElement('tr');
                row.innerHTML = `
                    <td>${startIndex + index + 1}</td>
                    <td>${loan.borrower}</td>
                    <td>${loan.articleType}</td>
                    <td>${loan.articleTitle}</td>
                    <td>${loan.loanDate}</td>
                    <td>${loan.returnDate}</td>
                    <td>
                        <i class="fas ${loan.status === 'Devuelto' ? 'fa-check-circle text-primary' : 'fa-times-circle text-danger'}"></i>
                    </td>
                    <td>
                        <button class="btn btn-primary btn-sm return-btn" onclick="markAsReturned(${loan.id})"><i class="fas fa-check"></i> Marcar como Devuelto</button>
                        <button class="btn btn-danger btn-sm not-returned-btn" onclick="markAsNotReturned(${loan.id})"><i class="fas fa-times"></i> No Devuelto</button>
                    </td>
                `;
                tableBody.appendChild(row);
            });

            renderPagination();
        }

        function changeItemsPerPage() {
            itemsPerPage = parseInt(document.getElementById('resourcePerPage').value);
            currentPage = 1;
            renderTable(currentPage);
        }

        function searchLoans() {
            const query = document.getElementById('searchInput').value.toLowerCase();
            filteredLoans = loans.filter(loan => {
                return loan.borrower.toLowerCase().includes(query) ||
                       loan.articleType.toLowerCase().includes(query) ||
                       loan.articleTitle.toLowerCase().includes(query);
            });
            currentPage = 1;
            renderTable(currentPage);
        }

        function renderPagination() {
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = '';

            const totalPages = Math.ceil(filteredLoans.length / itemsPerPage);
            for (let i = 1; i <= totalPages; i++) {
                const pageItem = document.createElement('li');
                pageItem.classList.add('page-item');
                if (i === currentPage) pageItem.classList.add('active');
                pageItem.innerHTML = `<a class="page-link" href="#" onclick="goToPage(${i})">${i}</a>`;
                pagination.appendChild(pageItem);
            }
        }

        function goToPage(page) {
            currentPage = page;
            renderTable(currentPage);
        }

        function registerLoan() {
            const borrowerName = document.getElementById('borrowerName').value;
            const articleTitle = document.getElementById('articleTitle').value;
            const loanDate = document.getElementById('loanDate').value;
            const returnDate = document.getElementById('returnDate').value;
            const articleType = document.getElementById('articleType').value;

            const newLoan = {
                id: loans.length + 1,
                borrower: borrowerName,
                articleTitle: articleTitle,
                loanDate: loanDate,
                returnDate: returnDate,
                articleType: articleType,
                status: 'No Devuelto'
            };

            loans.push(newLoan);
            filteredLoans = loans; 
            renderTable(currentPage);

           
            const modal = bootstrap.Modal.getInstance(document.getElementById('loanModal'));
            modal.hide();
            document.getElementById('loanForm').reset();
        }

        function markAsReturned(id) {
            const loan = loans.find(l => l.id === id);
            if (loan) {
                loan.status = 'Devuelto';
                renderTable(currentPage);
            }
        }

        function markAsNotReturned(id) {
            const loan = loans.find(l => l.id === id);
            if (loan) {
                loan.status = 'No Devuelto';
                renderTable(currentPage);
            }
        }

        
        renderTable(currentPage);
    </script>
</body>
</html>