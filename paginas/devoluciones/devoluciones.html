<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Devoluciones</title>
    <link rel="icon" href="../../static/img/fondo_aguilas_saber.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
    <div class="d-flex">
        <!-- Sidebar -->
        <div class="bg-dark text-white p-3" id="sidebar">
            <div class="text-center mb-4">
                <img src="../../static/img/fondo_aguilas_saber.png" alt="Logo Maky System" class="img-fluid mb-2" style="max-height: 80px;">
                <h4>Maky System</h4>
            </div>
            <ul class="nav flex-column">
                <li class="nav-item">
                    <a href="../../paginas/pagina_inicio/home.html" class="nav-link text-white">
                        <i class="fas fa-home me-2"></i>Inicio
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#adminSubmenu" class="nav-link text-white" data-bs-toggle="collapse" aria-expanded="false" aria-controls="adminSubmenu">
                        <i class="fas fa-cogs me-2"></i>Administración <i class="fas fa-chevron-down ms-auto"></i>
                    </a>
                    <div class="collapse" id="adminSubmenu">
                        <ul class="nav flex-column ms-3">
                            <li class="nav-item">
                                <a href="../../paginas/usuarios/listado-usuarios.html" class="nav-link text-white">
                                    <i class="fas fa-users me-2"></i>Usuarios
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/recursos/recursos.html" class="nav-link text-white">
                                    <i class="fas fa-boxes me-2"></i>Recursos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/prestamos/prestamos.html" class="nav-link text-white">
                                    <i class="fas fa-archive me-2"></i>Préstamos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/devoluciones/devoluciones.html" class="nav-link active text-white">
                                    <i class="fas fa-undo me-2"></i>Devoluciones
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/productos/listado-productos.html" class="nav-link text-white">
                                    <i class="fas fa-shopping-cart me-2"></i>Productos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/roles/listado-roles.html" class="nav-link text-white">
                                    <i class="fas fa-user-shield me-2"></i>Rol
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/roles/gestion-permisos.html" class="nav-link text-white">
                                    <i class="fas fa-key me-2"></i>Permisos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/recursos/estado-recursos.html" class="nav-link text-white">
                                    <i class="fas fa-chart-line me-2"></i>Estado de Recursos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/productos/ingreso-productos.html" class="nav-link text-white">
                                    <i class="fas fa-arrow-up me-2"></i>Ingresos
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
            <hr class="text-secondary">
            <a href="../../paginas/index/index.html" class="btn btn-danger w-100">Cerrar sesión</a>
        </div>

        <!-- Main Content -->
        <div class="flex-grow-1 p-4 bg-light">
            <h1 class="h4 mb-2">Gestión de Devoluciones</h1>
            <hr style="margin: 0.5rem 0; border: 1px solid rgba(0, 0, 0, 0.1); box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);">
            <p class="mt-1">Registrar y gestionar devoluciones de artículos</p>
            <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#addReturnModal">Agregar Devolución</button>
                
            <div class="d-flex justify-content-between mb-3">
                <div class="d-flex align-items-center">
                    <label for="resourcePerPage" class="me-2">Mostrar:</label>
                    <select id="resourcePerPage" class="form-select w-auto" onchange="changeItemsPerPage()">
                        <option value="10">10 Devoluciones</option>
                        <option value="20">20 Devoluciones</option>
                    </select>
                </div>
                <div class="input-group w-50">
                    <input type="text" id="searchInput" class="form-control" placeholder="Buscar devoluciones" oninput="searchReturns()">
                    <button class="btn btn-outline-secondary" id="searchButton" onclick="searchReturns()">
                        <i class="fas fa-search"></i>
                    </button>
                </div>                
            </div>

            
            <table class="table table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Solicitante</th>
                        <th>Tipo</th>
                        <th>Artículo</th>
                        <th>Fecha de Préstamo</th>
                        <th>Fecha de Devolución</th>
                        <th>Estado</th>
                    </tr>
                </thead>
                <tbody id="returnTableBody">
                    
                </tbody>                    
            </table>

            <nav aria-label="Page navigation">
                <ul class="pagination justify-content-center" id="pagination">
                    
                </ul>
            </nav>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-danger text-white text-center py-3 mt-auto">
        © 2024 Maky System. Todos los derechos reservados.
    </footer>

    <!-- Modal Agregar Devolución -->
<div class="modal fade" id="addReturnModal" tabindex="-1" aria-labelledby="addReturnModalLabel" aria-hidden="true">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title" id="addReturnModalLabel">Agregar Devolución</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
            </div>
            <div class="modal-body">
                <form id="addReturnForm">
                    <div class="mb-3">
                        <label for="borrowerName" class="form-label">Nombre del Solicitante</label>
                        <input type="text" class="form-control" id="borrowerName" required>
                    </div>
                    <div class="mb-3">
                        <label for="articleTitle" class="form-label">Título del Artículo</label>
                        <input type="text" class="form-control" id="articleTitle" required>
                    </div>
                    <div class="mb-3">
                        <label for="articleType" class="form-label">Tipo de Artículo</label>
                        <input type="text" class="form-control" id="articleType" required>
                    </div>
                    <div class="mb-3">
                        <label for="loanDate" class="form-label">Fecha de Préstamo</label>
                        <input type="date" class="form-control" id="loanDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="returnDate" class="form-label">Fecha de Devolución</label>
                        <input type="date" class="form-control" id="returnDate" required>
                    </div>
                    <div class="mb-3">
                        <label for="returnStatus" class="form-label">Estado de la Devolución</label>
                        <select class="form-select" id="returnStatus" required>
                            <option value="Devuelto">Devuelto</option>
                            <option value="No devuelto">No devuelto</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                <button type="button" class="btn btn-primary" onclick="addReturn()">Agregar</button>
                <!-- Contenedor para mensajes de error -->
            <div id="errorMessage" class="alert alert-danger mt-3" style="display: none;">Por favor, completa todos los campos antes de agregar un registro.</div>
            </div>
        </div>
    </div>
</div>


    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
        const returns = [
    { id: 1, borrower: "Juan Pérez", articleType: "Laptop", articleTitle: "HP Pavilion", loanDate: "2023-11-01", returnDate: "2023-12-01", status: "Devuelto" },
    { id: 2, borrower: "Maria Gómez", articleType: "Impresora", articleTitle: "Canon Pixma", loanDate: "2023-11-05", returnDate: "2023-12-05", status: "No devuelto" },
    { id: 3, borrower: "Carlos Ruiz", articleType: "Monitor", articleTitle: "LG UltraWide", loanDate: "2023-11-10", returnDate: "2023-12-10", status: "Devuelto" },
    { id: 4, borrower: "Ana López", articleType: "Laptop", articleTitle: "Dell XPS", loanDate: "2023-11-12", returnDate: "2023-12-12", status: "Devuelto" },
    { id: 5, borrower: "Javier Martínez", articleType: "Teclado", articleTitle: "Razer BlackWidow", loanDate: "2023-11-15", returnDate: "2023-12-15", status: "No devuelto" },
    { id: 6, borrower: "Isabel Fernández", articleType: "Impresora", articleTitle: "HP LaserJet", loanDate: "2023-11-18", returnDate: "2023-12-18", status: "Devuelto" },
    { id: 7, borrower: "Luis García", articleType: "Monitor", articleTitle: "Samsung Odyssey", loanDate: "2023-11-20", returnDate: "2023-12-20", status: "No devuelto" },
    { id: 8, borrower: "Sofia Rodríguez", articleType: "Laptop", articleTitle: "MacBook Pro", loanDate: "2023-11-22", returnDate: "2023-12-22", status: "Devuelto" },
    { id: 9, borrower: "Ricardo Torres", articleType: "Teclado", articleTitle: "Logitech G Pro", loanDate: "2023-11-25", returnDate: "2023-12-25", status: "No devuelto" },
    { id: 10, borrower: "Patricia Pérez", articleType: "Impresora", articleTitle: "Epson EcoTank", loanDate: "2023-11-28", returnDate: "2023-12-28", status: "Devuelto" },
    { id: 11, borrower: "Pedro Sánchez", articleType: "Monitor", articleTitle: "BenQ ZOWIE", loanDate: "2023-12-01", returnDate: "2023-12-30", status: "Devuelto" }
];

        let itemsPerPage = 10;
        let currentPage = 1;

        function renderTable(page) {
            const startIndex = (page - 1) * itemsPerPage;
            const endIndex = page * itemsPerPage;
            const currentReturns = returns.slice(startIndex, endIndex);

            const tableBody = document.getElementById('returnTableBody');
            tableBody.innerHTML = "";

            currentReturns.forEach((returnItem, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${startIndex + index + 1}</td>
                    <td>${returnItem.borrower}</td>
                    <td>${returnItem.articleType}</td>
                    <td>${returnItem.articleTitle}</td>
                    <td>${returnItem.loanDate}</td>
                    <td>${returnItem.returnDate}</td>
                    <td>
                        <i class="fas fa-check-circle" style="color:${returnItem.status === 'Devuelto' ? 'blue' : 'red'};"></i> ${returnItem.status}
                    </td>
                `;
                tableBody.appendChild(row);
            });

            renderPagination();
        }

        function renderPagination() {
            const totalPages = Math.ceil(returns.length / itemsPerPage);
            const pagination = document.getElementById('pagination');
            pagination.innerHTML = "";

            for (let i = 1; i <= totalPages; i++) {
                const pageItem = document.createElement("li");
                pageItem.classList.add("page-item");
                if (i === currentPage) pageItem.classList.add("active");

                pageItem.innerHTML = `<a class="page-link" href="#" onclick="goToPage(${i})">${i}</a>`;
                pagination.appendChild(pageItem);
            }
        }

        function goToPage(page) {
            currentPage = page;
            renderTable(page);
        }

        function changeItemsPerPage() {
            itemsPerPage = document.getElementById("resourcePerPage").value;
            renderTable(1);
        }

        function searchReturns() {
            const searchInput = document.getElementById("searchInput").value.toLowerCase();
            const filteredReturns = returns.filter(returnItem =>
                returnItem.borrower.toLowerCase().includes(searchInput) ||
                returnItem.articleTitle.toLowerCase().includes(searchInput) ||
                returnItem.articleType.toLowerCase().includes(searchInput)
            );
            const tableBody = document.getElementById('returnTableBody');
            tableBody.innerHTML = "";

            filteredReturns.forEach((returnItem, index) => {
                const row = document.createElement("tr");
                row.innerHTML = `
                    <td>${index + 1}</td>
                    <td>${returnItem.borrower}</td>
                    <td>${returnItem.articleType}</td>
                    <td>${returnItem.articleTitle}</td>
                    <td>${returnItem.loanDate}</td>
                    <td>${returnItem.returnDate}</td>
                    <td>
                        <i class="fas fa-check-circle" style="color:${returnItem.status === 'Devuelto' ? 'blue' : 'red'};"></i> ${returnItem.status}
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }

        function addReturn() {
    // Obtener los valores de los campos
    const borrowerName = document.getElementById("borrowerName").value.trim();
    const articleTitle = document.getElementById("articleTitle").value.trim();
    const articleType = document.getElementById("articleType").value.trim();
    const loanDate = document.getElementById("loanDate").value.trim();
    const returnDate = document.getElementById("returnDate").value.trim();
    const returnStatus = document.getElementById("returnStatus").value.trim();

    // Seleccionar el contenedor del mensaje de error
    const errorMessage = document.getElementById("errorMessage");

    // Validar que los campos no estén vacíos
    if (!borrowerName || !articleTitle || !articleType || !loanDate || !returnDate || !returnStatus) {
        errorMessage.style.display = "block"; // Mostrar mensaje
        errorMessage.textContent = "Por favor, completa todos los campos antes de agregar un registro.";
        return;
    }

    // Ocultar el mensaje de error si todo está bien
    errorMessage.style.display = "none";

    // Crear el nuevo objeto de devolución
    const newReturn = {
        id: returns.length + 1,
        borrower: borrowerName,
        articleTitle: articleTitle,
        articleType: articleType,
        loanDate: loanDate,
        returnDate: returnDate,
        status: returnStatus,
    };

    // Agregar el nuevo registro al array
    returns.push(newReturn);

    // Renderizar la tabla nuevamente
    renderTable(currentPage);

    // Resetear el formulario
    document.getElementById("addReturnForm").reset();

    // Cerrar el modal
    const modal = bootstrap.Modal.getInstance(document.getElementById("addReturnModal"));
    modal.hide();
}



        renderTable(currentPage);
    </script>
</body>
</html>