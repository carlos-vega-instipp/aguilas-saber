<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Usuarios</title>
    <link rel="icon" href="../../static/img/fondo_aguilas_saber.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="usuario.css" rel="stylesheet">
</head>
<body>
    <div class="d-flex">
        <!-- Sidebar -->
        <div id="sidebar" class="bg-dark text-white p-3">
            <div class="text-center mb-4">
                <img src="../../static/img/fondo_aguilas_saber.png" alt="Logo Maky System" class="img-fluid mb-2" style="max-height: 80px;">
                <h4>Maky System</h4>
            </div>
            <ul class="nav flex-column">
                <li class="nav-item">

                    <a href="../../paginas/pagina_inicio/dashboard.html" class="nav-link text-white">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                    </a>
                </li>
                <li class="nav-item">

                    <a href="../../paginas/pagina_inicio/home.html" class="nav-link text-white">
                        <i class="fas fa-home me-2"></i>Inicio
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#adminSubmenu" class="nav-link text-white" data-bs-toggle="collapse" aria-expanded="false">
                        <i class="fas fa-cogs me-2"></i>Administración <i class="fas fa-chevron-down ms-auto"></i>
                    </a>
                    <div class="collapse" id="adminSubmenu">
                        <ul class="nav flex-column ms-3">
                            <li class="nav-item">
                                <a href="../../paginas/usuarios/listado-usuarios.html" class="nav-link active text-white"><i class="fas fa-users me-2"></i>Usuarios</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/recursos/recursos.html" class="nav-link text-white"><i class="fas fa-boxes me-2"></i>Recursos</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/prestamos/prestamos.html" class="nav-link text-white"><i class="fas fa-archive me-2"></i>Préstamos</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/devoluciones/devoluciones.html" class="nav-link text-white"><i class="fas fa-undo me-2"></i>Devoluciones</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/productos/listado-productos.html" class="nav-link text-white"><i class="fas fa-shopping-cart me-2"></i>Productos</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/roles/listado-roles.html" class="nav-link text-white"><i class="fas fa-user-shield me-2"></i>Rol</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/roles/gestion-permisos.html" class="nav-link text-white"><i class="fas fa-key me-2"></i>Permisos</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/recursos/estado-recursos.html" class="nav-link text-white"><i class="fas fa-chart-line me-2"></i>Estado de Recursos</a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/productos/ingreso-productos.html" class="nav-link text-white"><i class="fas fa-arrow-up me-2"></i>Ingresos</a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
            <hr class="text-secondary">
            <a href="../../paginas/index/index.html" class="btn btn-danger w-100">Cerrar sesión</a>
        </div>

        <!-- Main Content -->
        <div class="main-content flex-grow-1 p-3">
            <h1 class="h4 mb-3">Gestión de Usuarios</h1>
            <p>Seleccione una acción para gestionar usuarios.</p>
            <a href="../../paginas/usuarios/agregar-usuario.html" class="btn btn-success mb-3">Agregar Usuario</a>

            <div class="d-flex justify-content-between mb-3">
                <div class="d-flex align-items-center">
                    <label for="userPerPage" class="me-2">Mostrar:</label>
                    <select id="userPerPage" class="form-select w-auto">
                        <option value="10">10 Usuarios</option>
                        <option value="20">20 Usuarios</option>
                    </select>
                </div>
                <div class="input-group w-50">
                    <input type="text" id="searchInput" class="form-control" placeholder="Buscar usuarios">
                    <button class="btn btn-outline-secondary" id="searchButton"><i class="fas fa-search"></i></button>
                </div>
            </div>

            <table class="table table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Nombre</th>
                        <th>Apellido</th>
                        <th>Correo Electrónico</th>
                        <th>Teléfono</th>
                        <th>Rol</th>
                        <th>Estado</th>
                        <th>Editar</th>
                        <th>Eliminar</th>
                    </tr>
                </thead>
                <tbody id="userTableBody"></tbody>
            </table>

            <nav>
                <ul class="pagination justify-content-center" id="pagination"></ul>
            </nav>
        </div>
    </div>

    <!-- Modal de Confirmación de Eliminación -->
    <div class="modal fade" id="confirmModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Confirmar Eliminación</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">¿Estás seguro de que deseas eliminar al usuario <span id="userNameToDelete"></span>?</div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                    <button type="button" class="btn btn-danger" onclick="deleteUser()">Eliminar</button>
                </div>
            </div>

        </div>
    </div>

    <!-- Modal de Notificación de Éxito -->
    <div class="modal fade" id="successModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Usuario Eliminado</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">El usuario ha sido eliminado satisfactoriamente.</div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-primary" data-bs-dismiss="modal">Aceptar</button>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal de Edición de Usuario -->
<div class="modal fade" id="editModal" tabindex="-1">
    <div class="modal-dialog">
        <div class="modal-content">
            <div class="modal-header">
                <h5 class="modal-title">Editar Usuario</h5>
                <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <form id="editUserForm">
                    <div class="mb-3">
                        <label for="editName" class="form-label">Nombre</label>
                        <input type="text" class="form-control" id="editName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editLastName" class="form-label">Apellido</label>
                        <input type="text" class="form-control" id="editLastName" required>
                    </div>
                    <div class="mb-3">
                        <label for="editEmail" class="form-label">Correo Electrónico</label>
                        <input type="email" class="form-control" id="editEmail" required>
                    </div>
                    <div class="mb-3">
                        <label for="editPhone" class="form-label">Teléfono</label>
                        <input type="text" class="form-control" id="editPhone" required>
                    </div>
                    <div class="mb-3">
                        <label for="editRole" class="form-label">Rol</label>
                        <select class="form-select" id="editRole" required>
                            <option value="Administrador">Administrador</option>
                            <option value="Usuario">Usuario</option>
                        </select>
                    </div>
                    <div class="mb-3">
                        <label for="editStatus" class="form-label">Estado</label>
                        <select class="form-select" id="editStatus" required>
                            <option value="Activo">Activo</option>
                            <option value="Inactivo">Inactivo</option>
                        </select>
                    </div>
                </form>
            </div>
            <div class="modal-footer">
                <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                <button type="button" class="btn btn-primary" onclick="saveUserChanges()">Guardar Cambios</button>
            </div>
        </div>
    </div>
</div>

    <footer id="footer" class="bg-danger text-white text-center py-3 mt-auto">
        © 2024 Maky System. Todos los derechos reservados.
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    let users = [
        { id: 1, name: "Juan", lastName: "Pérez", email: "juan.perez@example.com", phone: "0987654321", role: "Administrador", status: "Activo" },
        { id: 2, name: "María", lastName: "García", email: "maria.garcia@example.com", phone: "0987654322", role: "Usuario", status: "Inactivo" },
        { id: 3, name: "Pedro", lastName: "Gómez", email: "pedro.gomez@example.com", phone: "0987654323", role: "Usuario", status: "Activo" },
        { id: 4, name: "Ana", lastName: "Martínez", email: "ana.martinez@example.com", phone: "0987654324", role: "Administrador", status: "Activo" },
        { id: 5, name: "Luis", lastName: "Hernández", email: "luis.hernandez@example.com", phone: "0987654325", role: "Usuario", status: "Inactivo" },
        { id: 6, name: "Lucía", lastName: "López", email: "lucia.lopez@example.com", phone: "0987654326", role: "Usuario", status: "Activo" },
        { id: 7, name: "Carlos", lastName: "Sánchez", email: "carlos.sanchez@example.com", phone: "0987654327", role: "Administrador", status: "Activo" },
        { id: 8, name: "Sofía", lastName: "Ramírez", email: "sofia.ramirez@example.com", phone: "0987654328", role: "Usuario", status: "Inactivo" },
        { id: 9, name: "José", lastName: "Torres", email: "jose.torres@example.com", phone: "0987654329", role: "Usuario", status: "Activo" },
        { id: 10, name: "Isabel", lastName: "Vázquez", email: "isabel.vazquez@example.com", phone: "0987654330", role: "Administrador", status: "Inactivo" },
        { id: 11, name: "Fernando", lastName: "Jiménez", email: "fernando.jimenez@example.com", phone: "0987654331", role: "Usuario", status: "Activo" },
        { id: 12, name: "Marta", lastName: "Morales", email: "marta.morales@example.com", phone: "0987654332", role: "Usuario", status: "Inactivo" },
    ];
    
    let currentPage = 1;
let usersPerPage = 10;
let userIdToDelete;

function renderTable() {
    const startIndex = (currentPage - 1) * usersPerPage;
    const endIndex = startIndex + usersPerPage;
    const visibleUsers = users.slice(startIndex, endIndex);

    const tableBody = document.getElementById("userTableBody");
    tableBody.innerHTML = '';

    visibleUsers.forEach((user, index) => {
        const row = document.createElement("tr");
        row.innerHTML = `
            <td>${startIndex + index + 1}</td>
            <td>${user.name}</td>
            <td>${user.lastName}</td>
            <td>${user.email}</td>
            <td>${user.phone}</td>
            <td>${user.role}</td>
            <td>${user.status}</td>
            <td><i class="fas fa-edit text-primary btn-icon" onclick="editUser(${user.id})"></i></td>
            <td><i class="fas fa-trash-alt text-danger btn-icon" onclick="confirmDelete(${user.id}, '${user.name}')"></i></td>
        `;
        tableBody.appendChild(row);
    });
}

function renderPagination() {
    const totalPages = Math.ceil(users.length / usersPerPage);
    const pagination = document.getElementById("pagination");
    pagination.innerHTML = '';

    for (let i = 1; i <= totalPages; i++) {
        const pageItem = document.createElement("li");
        pageItem.classList.add("page-item");
        pageItem.innerHTML = `
            <a class="page-link" href="#" onclick="changePage(${i})">${i}</a>
        `;
        pagination.appendChild(pageItem);
    }
}

function changePage(page) {
    currentPage = page;
    renderTable();
    renderPagination();
}

let originalUsers = [...users]; 

function searchUsers() {
    const searchTerm = document.getElementById("searchInput").value.toLowerCase();

    if (searchTerm === "") {

        users = [...originalUsers];
    } else {

        users = originalUsers.filter(user =>
            user.name.toLowerCase().includes(searchTerm) ||
            user.lastName.toLowerCase().includes(searchTerm) ||
            user.email.toLowerCase().includes(searchTerm)
        );
    }

    currentPage = 1; 
    renderTable();
    renderPagination();
}


function confirmDelete(id, name) {
    userIdToDelete = id;
    document.getElementById("userNameToDelete").innerText = name;
    new bootstrap.Modal(document.getElementById('confirmModal')).show();
}

function deleteUser() {
    users = users.filter(user => user.id !== userIdToDelete);
    userIdToDelete = null;
    renderTable();
    renderPagination();

    // Cerrar el modal de confirmación
    const confirmModal = document.getElementById('confirmModal');
    const confirmModalInstance = bootstrap.Modal.getInstance(confirmModal); 
    confirmModalInstance.hide();

    // Mostrar el modal de éxito
    new bootstrap.Modal(document.getElementById('successModal')).show();
}



document.getElementById("userPerPage").addEventListener("change", function () {
    usersPerPage = parseInt(this.value);
    currentPage = 1;  
    renderTable();
    renderPagination();
});

document.getElementById("searchButton").addEventListener("click", searchUsers);
document.getElementById("searchInput").addEventListener("input", searchUsers);

window.onload = function() {
    renderTable();
    renderPagination();
};

let userIdToEdit;

function editUser(id) {
    userIdToEdit = id;
    const user = users.find(u => u.id === userIdToEdit);

    document.getElementById("editName").value = user.name;
    document.getElementById("editLastName").value = user.lastName;
    document.getElementById("editEmail").value = user.email;
    document.getElementById("editPhone").value = user.phone;
    document.getElementById("editRole").value = user.role;
    document.getElementById("editStatus").value = user.status;

    new bootstrap.Modal(document.getElementById('editModal')).show();
}

function saveUserChanges() {
    const user = users.find(u => u.id === userIdToEdit);

    user.name = document.getElementById("editName").value;
    user.lastName = document.getElementById("editLastName").value;
    user.email = document.getElementById("editEmail").value;
    user.phone = document.getElementById("editPhone").value;
    user.role = document.getElementById("editRole").value;
    user.status = document.getElementById("editStatus").value;

    renderTable();
    renderPagination();

    // Cerrar el modal
    const editModal = document.getElementById('editModal');
    const editModalInstance = bootstrap.Modal.getInstance(editModal);
    editModalInstance.hide();
}

function capitalizeFirstLetter(string) {
    return string.charAt(0).toUpperCase() + string.slice(1).toLowerCase();
}
const sidebar = document.getElementById('sidebar');
const mainContent = document.querySelector('.main-content');

function adjustSidebarHeight() {
    const contentHeight = mainContent.offsetHeight;
}


window.addEventListener('load', adjustSidebarHeight);
window.addEventListener('resize', adjustSidebarHeight);
</script>
</body>
</html>