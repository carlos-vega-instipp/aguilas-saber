<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Gestión de Ingreso de Productos</title>
    <link rel="icon" href="../../static/img/fondo_aguilas_saber.png" type="image/x-icon">
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="ingreso_productos.css" rel="stylesheet">
</head>
<body>
    <div class="d-flex">
        <!-- Sidebar -->
        <div class="bg-dark text-white p-3" id="sidebar">
            <div class="text-center mb-4">
                <img src="../../static/img/fondo_aguilas_saber.png" alt="Logo Maky System" class="img-fluid mb-2" style="max-height: 80px;">
                <h4>Maky System</h4>
            </div>
            <ul class="nav flex-column">
                <li class="nav-item">

                    <a href="../../paginas/pagina_inicio/dashboard.html" class="nav-link text-white">
                        <i class="fas fa-tachometer-alt me-2"></i>Dashboard
                    </a>
                </li>
                <li class="nav-item">
                    <a href="../../paginas/pagina_inicio/home.html" class="nav-link text-white">
                        <i class="fas fa-home me-2"></i>Inicio
                    </a>
                </li>
                <li class="nav-item">
                    <a href="#adminSubmenu" class="nav-link text-white" data-bs-toggle="collapse" aria-expanded="false" aria-controls="adminSubmenu">
                        <i class="fas fa-cogs me-2"></i>Administración <i class="fas fa-chevron-down ms-auto"></i>
                    </a>
                    <div class="collapse" id="adminSubmenu">
                        <ul class="nav flex-column ms-3">
                            <li class="nav-item">
                                <a href="../../paginas/usuarios/listado-usuarios.html" class="nav-link text-white">
                                    <i class="fas fa-users me-2"></i>Usuarios
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/recursos/recursos.html" class="nav-link text-white">
                                    <i class="fas fa-boxes me-2"></i>Recursos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/prestamos/prestamos.html" class="nav-link text-white">
                                    <i class="fas fa-archive me-2"></i>Préstamos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/devoluciones/devoluciones.html" class="nav-link text-white">
                                    <i class="fas fa-undo me-2"></i>Devoluciones
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/productos/listado-productos.html" class="nav-link text-white">
                                    <i class="fas fa-shopping-cart me-2"></i>Productos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/roles/listado-roles.html" class="nav-link text-white">
                                    <i class="fas fa-user-shield me-2"></i>Rol
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/roles/gestion-permisos.html" class="nav-link text-white">
                                    <i class="fas fa-key me-2"></i>Permisos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/recursos/estado-recursos.html" class="nav-link text-white">
                                    <i class="fas fa-chart-line me-2"></i>Estado de Recursos
                                </a>
                            </li>
                            <li class="nav-item">
                                <a href="../../paginas/productos/ingreso-productos.html" class="nav-link active text-white">
                                    <i class="fas fa-arrow-up me-2"></i>Ingresos
                                </a>
                            </li>
                        </ul>
                    </div>
                </li>
            </ul>
            <hr class="text-secondary">
            <a href="../../paginas/index/index.html" class="btn btn-danger w-100">Cerrar sesión</a>
        </div>

        <!-- Main Content -->
        <div class="flex-grow-1 p-4 bg-light">
            <h1 class="h4 mb-2">Gestión de Ingreso de Productos</h1>
            <hr style="margin: 0.5rem 0; border: 1px solid rgba(0, 0, 0, 0.1); box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);">
            <p class="mt-1">Llenar los campos para registrar o editar el ingreso de productos</p>
            <button class="btn btn-success mb-3" data-bs-toggle="modal" data-bs-target="#productModal">Agregar Ingreso de Producto</button>


            <div class="d-flex justify-content-between mb-3">
                <div class="d-flex align-items-center">
                    <label for="usersPerPage" class="me-2">Mostrar:</label>
                    <select id="usersPerPage" class="form-select w-auto">
                        <option value="10" selected>10 Ingresos</option>
                        <option value="20">20 Ingresos</option>
                    </select>
                </div>

                <div class="input-group w-50">
                    <input type="text" id="searchUsers" class="form-control" placeholder="Buscar Ingresos" aria-label="Buscar usuarios">
                    <button class="btn btn-outline-secondary" type="button" id="searchButton">
                        <i class="fas fa-search"></i>
                    </button>
                </div>
            </div>

            <div class="modal fade" id="productModal" tabindex="-1" aria-labelledby="productModalLabel" aria-hidden="true">
                <div class="modal-dialog">
                    <div class="modal-content">
                        <div class="modal-header">
                            <h5 class="modal-title" id="productModalLabel">Agregar Ingreso de Producto</h5>
                            <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                        </div>
                        <div class="modal-body">
                            <form id="productForm">
                                <div class="mb-3">
                                    <label for="productId" class="form-label">ID</label>
                                    <input type="number" class="form-control" id="productId" required disabled>
                                </div>
                                <div class="mb-3">
                                    <label for="productDate" class="form-label">Fecha de Ingreso</label>
                                    <input type="date" class="form-control" id="productDate" required>
                                </div>
                                <div class="mb-3">
                                    <label for="productName" class="form-label">Producto</label>
                                    <input type="text" class="form-control" id="productName" required>
                                </div>
                                <div class="mb-3">
                                    <label for="productQuantity" class="form-label">Cantidad</label>
                                    <input type="number" class="form-control" id="productQuantity" required>
                                </div>
                                <div class="mb-3">
                                    <label for="userRegister" class="form-label">Usuario de Registro</label>
                                    <input type="text" class="form-control" id="userRegister" required>
                                </div>
                            </form>
                        </div>
                        <div class="modal-footer">
                            <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                            <button type="button" class="btn btn-primary" id="saveProductBtn">Guardar</button>
                        </div>
                    </div>
                </div>
            </div>

            <table class="table table-striped">
                <thead class="table-dark">
                    <tr>
                        <th>#</th>
                        <th>Fecha de Ingreso</th>
                        <th>Producto</th>
                        <th>Cantidad</th>
                        <th>Usuario de Registro</th>
                        <th>Editar</th>
                        <th>Eliminar</th>
                    </tr>
                </thead>
                <tbody id="productTableBody">
                    <!-- Productos de ejemplo -->
                    <tr>
                        <td>1</td>
                        <td>2025-01-07</td>
                        <td>Monitor</td>
                        <td>10</td>
                        <td>admin01</td>
                        <td><button class="btn btn-icon text-primary editBtn"><i class="fas fa-edit"></i></button></td>
                        <td><button class="btn btn-icon text-danger deleteBtn"><i class="fas fa-trash-alt"></i></button></td>
                    </tr>
                    <tr>
                        <td>2</td>
                        <td>2025-01-07</td>
                        <td>Teclado</td>
                        <td>20</td>
                        <td>admin02</td>
                        <td><button class="btn btn-icon text-primary editBtn"><i class="fas fa-edit"></i></button></td>
                        <td><button class="btn btn-icon text-danger deleteBtn"><i class="fas fa-trash-alt"></i></button></td>
                    </tr>
                </tbody>
            </table>
            
            <!-- Paginación -->
            <nav class="d-flex justify-content-center">
                <ul class="pagination" id="pagination">
                    <!-- Los botones de paginación se agregarán aquí dinámicamente -->
                </ul>
            </nav>
        </div>
    </div>



        <div class="modal fade" id="deleteConfirmModal" tabindex="-1" aria-labelledby="deleteConfirmModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="deleteConfirmModalLabel">Confirmar Eliminación</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        ¿Estás seguro de que deseas eliminar este producto? Esta acción no se puede deshacer.
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancelar</button>
                        <button type="button" class="btn btn-danger" id="confirmDeleteBtn">Eliminar</button>
                    </div>
                </div>
            </div>
        </div>

        <div class="modal fade" id="successDeleteModal" tabindex="-1" aria-labelledby="successDeleteModalLabel" aria-hidden="true">
            <div class="modal-dialog">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="successDeleteModalLabel">Eliminación Exitosa</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>
                    <div class="modal-body">
                        El producto ha sido eliminado exitosamente.
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cerrar</button>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- Footer -->
    <footer class="bg-danger text-white text-center py-3">
        © 2024 Maky System. Todos los derechos reservados.
    </footer>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0-alpha3/dist/js/bootstrap.bundle.min.js"></script>
    <script>
    let currentRow = null;

let currentPage = 1;
const rowsPerPage = 10; // Fijar el número de filas por página

// Función para actualizar la tabla con los productos
function renderTable() {
    const rows = Array.from(document.querySelectorAll('#productTableBody tr'));
    const searchQuery = document.getElementById('searchUsers').value.toLowerCase();

    // Filtrar las filas según la búsqueda
    const filteredRows = rows.filter(row => {
        const cells = row.querySelectorAll('td');
        return Array.from(cells).some(cell => cell.innerText.toLowerCase().includes(searchQuery));
    });

    // Calcular el número de páginas
    const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
    const startIndex = (currentPage - 1) * rowsPerPage;
    const endIndex = startIndex + rowsPerPage;
    
    // Mostrar solo las filas de la página actual
    const paginatedRows = filteredRows.slice(startIndex, endIndex);
    
    // Limpiar la tabla
    document.getElementById('productTableBody').innerHTML = '';

    // Insertar las filas filtradas y paginadas
    paginatedRows.forEach(row => {
        document.getElementById('productTableBody').appendChild(row);
    });

    // Actualizar los controles de paginación
    updatePagination(filteredRows.length, totalPages);
}

// Función para actualizar los botones de paginación
function updatePagination(filteredRowsCount, totalPages) {
    const paginationContainer = document.getElementById('pagination');
    paginationContainer.innerHTML = ''; // Limpiar la paginación actual

    // Generar los botones de paginación
    for (let i = 1; i <= totalPages; i++) {
        const pageButton = document.createElement('li');
        pageButton.classList.add('page-item');
        pageButton.innerHTML = `
            <a class="page-link" href="#">${i}</a>
        `;
        pageButton.addEventListener('click', function() {
            currentPage = i;
            renderTable();
        });
        paginationContainer.appendChild(pageButton);
    }
}

// Lógica para la búsqueda en tiempo real
document.getElementById('searchUsers').addEventListener('input', function() {
    currentPage = 1; // Reiniciar a la primera página cuando se realiza una búsqueda
    renderTable();
});


    // Lógica de edición y eliminación de productos
document.getElementById('productTableBody').addEventListener('click', function(e) {
    if (e.target.closest('.editBtn')) {
        const row = e.target.closest('tr');
        document.getElementById('productId').value = row.cells[0].innerText;
        document.getElementById('productDate').value = row.cells[1].innerText;
        document.getElementById('productName').value = row.cells[2].innerText;
        document.getElementById('productQuantity').value = row.cells[3].innerText;
        document.getElementById('userRegister').value = row.cells[4].innerText;

        currentRow = row;
        const modal = new bootstrap.Modal(document.getElementById('productModal'));
        modal.show();
    }

    if (e.target.closest('.deleteBtn')) {
        const rowToDelete = e.target.closest('tr');
        currentRow = rowToDelete;
        const deleteConfirmModal = new bootstrap.Modal(document.getElementById('deleteConfirmModal'));
        deleteConfirmModal.show();
    }
});

document.getElementById('confirmDeleteBtn').addEventListener('click', function() {
    if (currentRow) {
        currentRow.remove();

        // Cerrar el modal de confirmación de eliminación
        const deleteConfirmModal = bootstrap.Modal.getInstance(document.getElementById('deleteConfirmModal'));
        deleteConfirmModal.hide();

        // Mostrar el modal de éxito
        const successDeleteModal = new bootstrap.Modal(document.getElementById('successDeleteModal'));
        successDeleteModal.show();

        // Actualizar la tabla después de eliminar un producto
        renderTable(); // Este renderTable() ya está presente aquí
    }
});

// Asegúrate de cerrar el modal de éxito automáticamente después de un tiempo
document.getElementById('successDeleteModal').addEventListener('shown.bs.modal', function() {
    setTimeout(() => {
        const successDeleteModal = bootstrap.Modal.getInstance(document.getElementById('successDeleteModal'));
        successDeleteModal.hide();
    }, 2000); // Cerrar después de 2 segundos
});

document.getElementById('saveProductBtn').addEventListener('click', function () {
    // Obtener valores de los inputs
    const id = document.getElementById('productId').value || document.querySelectorAll('#productTableBody tr').length + 1;
    const date = document.getElementById('productDate').value.trim();
    const name = document.getElementById('productName').value.trim();
    const quantity = document.getElementById('productQuantity').value.trim();
    const user = document.getElementById('userRegister').value.trim();

    // Validar que los campos requeridos no estén vacíos
    if (!date || !name || !quantity || !user) {
        alert('Todos los campos son obligatorios. Por favor, completa toda la información.');
        return;
    }

    if (currentRow) {
        // Editar una fila existente
        currentRow.cells[0].innerText = id;
        currentRow.cells[1].innerText = date;
        currentRow.cells[2].innerText = name;
        currentRow.cells[3].innerText = quantity;
        currentRow.cells[4].innerText = user;
    } else {
        // Crear una nueva fila
        const newRow = document.createElement('tr');
        newRow.innerHTML = `
            <td>${id}</td>
            <td>${date}</td>
            <td>${name}</td>
            <td>${quantity}</td>
            <td>${user}</td>
            <td><button class="btn btn-icon text-primary editBtn"><i class="fas fa-edit"></i></button></td>
            <td><button class="btn btn-icon text-danger deleteBtn"><i class="fas fa-trash-alt"></i></button></td>
        `;
        document.getElementById('productTableBody').appendChild(newRow);
    }

    // Limpiar los inputs del formulario
    document.getElementById('productId').value = '';
    document.getElementById('productDate').value = '';
    document.getElementById('productName').value = '';
    document.getElementById('productQuantity').value = '';
    document.getElementById('userRegister').value = '';

    // Cerrar el modal
    const productModal = bootstrap.Modal.getInstance(document.getElementById('productModal'));
    productModal.hide();

    // Actualizar la tabla después de guardar o editar un producto
    renderTable(); // Ya está correctamente aquí
});

// Inicializar la tabla cuando la página cargue
document.addEventListener('DOMContentLoaded', function() {
    renderTable(); // Renderizar la tabla cuando la página se cargue
});

</script>
</body>
</html>